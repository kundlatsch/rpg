{% extends "base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/pages/inventory.css' %}">
{% endblock %}

{% block content %}
<div class="inventory-page">
    <!-- Cabe√ßalho do invent√°rio -->
    <div class="inventory-header">
        <h1 class="inventory-main-title">
            Invent√°rio de {{ character.name }}
        </h1>
        <p class="inventory-subtitle">Gerencie seus itens e equipamentos</p>
    </div>

    <div class="inventory-divider"></div>

    <div class="inventory-main-grid">
        <!-- Coluna da esquerda - Lista de itens com tabs -->
        <div class="inventory-column inventory-column-left">
            <div class="inventory-sidebar">
                <!-- Filtro de texto -->
                <div class="inventory-search-container">
                    <input type="text" class="inventory-search" id="itemFilter" placeholder="üîç Filtrar itens...">
                </div>
                
                <!-- Tabs para os tipos de itens -->
                <div class="inventory-tabs" id="itemTabs">
                    <button class="inventory-tab inventory-tab-active" data-target="equipment" title="Equipamentos">
                        <span class="inventory-tab-icon">üõ°Ô∏è</span>
                        <span class="inventory-tab-text">Equip.</span>
                    </button>
                    <button class="inventory-tab" data-target="consumable" title="Consum√≠veis">
                        <span class="inventory-tab-icon">üß™</span>
                        <span class="inventory-tab-text">Consum.</span>
                    </button>
                    <button class="inventory-tab" data-target="material" title="Materiais">
                        <span class="inventory-tab-icon">üì¶</span>
                        <span class="inventory-tab-text">Mater.</span>
                    </button>
                </div>
                
                <!-- Conte√∫do das tabs -->
                <div class="inventory-tab-content">
                    <!-- Tab de Equipamentos -->
                    <div class="inventory-tab-pane inventory-tab-pane-active" id="equipment" role="tabpanel">
                        <div class="inventory-item-list">
                            {% for inv in equipment %}
                            <div class="inventory-item-card inventory-rarity-{{ inv.item.rarity }}" 
                              data-id="{{ inv.id }}"
                              data-type="equipment" 
                              data-equipped="false"
                              data-name="{{ inv.item.name }}" 
                              data-description="{{ inv.item.description }}" 
                              data-emoji="{{ inv.item.emoji }}" 
                              data-rarity="{{ inv.item.rarity }}"
                              data-rarity-display="{{ inv.item.get_rarity_display }}"
                              data-min-level="{{ inv.item.equipment.min_level }}"
                              data-stats="{{ inv.item.equipment.formatted_equipment_stats|default:'' }}"
                              data-attribute-bonuses="{{ inv.item.equipment.attribute_bonuses_strings }}"
                              data-passive-skill="{{ inv.item.equipment.passive_skill|default:'{}'|escapejs }}"
                              data-formatted-effects="{{ inv.item.equipment.formatted_passive_skill_effects }}"
                              data-trigger="{{ inv.item.equipment.trigger_string }}"
                              data-crafting-recipe="{{ inv.item.recipe_strings|default:'{}'|escapejs }}"
                            >
                                <div class="inventory-item-card-content">
                                    <span class="inventory-item-emoji">{{ inv.item.emoji }}</span>
                                    <div class="inventory-item-info">
                                        <h6 class="inventory-item-name">{{ inv.item.name }}</h6>
                                        <small class="inventory-item-quantity">x{{ inv.quantity }}</small>
                                    </div>
                                </div>
                            </div>
                            {% empty %}
                            <p class="inventory-empty-message">Nenhum equipamento.</p>
                            {% endfor %}
                        </div>
                    </div>
                    
                    <!-- Tab de Consum√≠veis -->
                    <div class="inventory-tab-pane" id="consumable" role="tabpanel">
                        <div class="inventory-item-list">
                            {% for inv in consumables %}
                              <div class="inventory-item-card inventory-rarity-{{ inv.item.rarity }}" 
                                data-id="{{ inv.id }}" 
                                data-type="consumable"
                                data-name="{{ inv.item.name }}" 
                                data-description="{{ inv.item.description }}" 
                                data-emoji="{{ inv.item.emoji }}" 
                                data-rarity="{{ inv.item.rarity }}"
                                data-min-level="{{ inv.item.consumable.min_level }}"
                                data-affected-attributes='{{ inv.item.consumable.affected_attributes|safe }}'
                                data-attribute-bonuses='{{ inv.item.consumable.attribute_bonuses|safe }}'
                                data-crafting-recipe='{{ inv.item.recipe_strings|safe }}'
                              >
                                <div class="inventory-item-card-content">
                                    <span class="inventory-item-emoji">{{ inv.item.emoji }}</span>
                                    <div class="inventory-item-info">
                                        <h6 class="inventory-item-name">{{ inv.item.name }}</h6>
                                        <small class="inventory-item-quantity">x{{ inv.quantity }}</small>
                                    </div>
                                </div>
                            </div>
                            {% empty %}
                            <p class="inventory-empty-message">Nenhum consum√≠vel.</p>
                            {% endfor %}
                        </div>
                    </div>
                    
                    <!-- Tab de Materiais -->
                    <div class="inventory-tab-pane" id="material" role="tabpanel">
                        <div class="inventory-item-list">
                            {% for inv in materials %}
                              <div class="inventory-item-card inventory-rarity-{{ inv.item.rarity }}" 
                                data-id="{{ inv.id }}" 
                                data-type="material"
                                data-name="{{ inv.item.name }}" 
                                data-description="{{ inv.item.description }}" 
                                data-emoji="{{ inv.item.emoji }}" 
                                data-rarity="{{ inv.item.rarity }}"
                                data-crafting-recipe='{{ inv.item.recipe_strings|safe }}'
                              >
                                <div class="inventory-item-card-content">
                                    <span class="inventory-item-emoji">{{ inv.item.emoji }}</span>
                                    <div class="inventory-item-info">
                                        <h6 class="inventory-item-name">{{ inv.item.name }}</h6>
                                        <small class="inventory-item-quantity">x{{ inv.quantity }}</small>
                                    </div>
                                </div>
                            </div>
                            {% empty %}
                            <p class="inventory-empty-message">Nenhum material.</p>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Coluna da direita - Detalhes do item -->
        <div class="inventory-column inventory-column-right">
            <div class="inventory-details">
                <div class="inventory-no-selection" id="no-item-selected">
                    <div class="inventory-no-selection-icon">üëÜ</div>
                    <h4 class="inventory-no-selection-title">Selecione um item</h4>
                    <p class="inventory-no-selection-text">Clique em um item √† esquerda para ver seus detalhes</p>
                </div>
                
                <div id="item-details-content" class="inventory-details-content inventory-details-hidden">
                    <div class="inventory-details-header">
                        <div class="inventory-emoji-name">
                            <span id="detail-emoji" class="inventory-details-emoji"></span>
                            <h3 id="detail-name" class="inventory-details-name"></h3>
                        </div>
                        <span id="detail-rarity" class="inventory-details-rarity"></span>
                    </div>
                    
                    <div class="inventory-details-description">
                        <p id="detail-description" class="inventory-details-description-text"></p>
                    </div>
                    
                    <div class="inventory-details-stats" id="detail-stats">
                        <!-- As estat√≠sticas ser√£o preenchidas via JavaScript -->
                    </div>
                    
                    <div id="item-actions" class="inventory-details-actions">
                        <!-- Bot√µes de a√ß√£o ser√£o adicionados aqui -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Se√ß√£o de Equipamentos Atuais (embaixo) -->
    <div class="character-section character-equipment-section">
        <h3 class="inventory-equipment-title">Equipamentos Atuais</h3>
        
        <div class="inventory-equipment-grid">
            <!-- Slots superiores -->
            <div class="equipment-row">
                {% for slot in upper_slots %}
                    <div class="equipment-slot-container"
                        data-type="equipment"
                        data-equipped="true"
                        data-id="{{ slot.equipment.item.id|default:'' }}"
                        data-emoji="{{ slot.equipment.item.emoji|default:'‚ùî' }}"
                        data-name="{{ slot.equipment.item.name|default:slot.name }}"
                        data-description="{{ slot.equipment.item.description|default:'Nenhum item equipado' }}"
                        data-rarity="{{ slot.equipment.item.rarity|default:'common' }}"
                        data-rarity-display="{{ slot.equipment.item.get_rarity_display }}"
                        data-min-level="{{ slot.equipment.min_level|default:1 }}"
                        data-stats="{{ slot.equipment.formatted_equipment_stats|default:'' }}"
                        data-attribute-bonuses="{{ slot.equipment.attribute_bonuses_strings|default:'{}'|escapejs }}"
                        data-passive-skill="{{ slot.equipment.passive_skill|default:'{}'|escapejs }}"
                        data-formatted-effects="{{ slot.equipment.formatted_passive_skill_effects }}"
                        data-trigger="{{ slot.equipment.trigger_string }}"
                        data-crafting-recipe="{{ slot.equipment.item.recipe_strings|default:'{}'|escapejs }}"
                    >
                        {% include "items/_equipment_slot.html" with slot_name=slot.name slot_icon=slot.icon slot_equipment=slot.equipment %}
                    </div>
                {% endfor %}
            </div>

            <!-- Personagem central -->
            <div class="inventory-character-center">
                <div class="inventory-character-emoji-bg">
                    <div class="inventory-character-emoji">
                        {{ character.emoji }}
                    </div>
                </div>
            </div>

            <!-- Slots inferiores -->
            <div class="equipment-row">
                {% for slot in lower_slots %}
                    <div class="equipment-slot-container"
                        data-type="equipment"
                        data-equipped="true"
                        data-id="{{ slot.equipment.item.id|default:'' }}"
                        data-emoji="{{ slot.equipment.item.emoji|default:'‚ùî' }}"
                        data-name="{{ slot.equipment.item.name|default:slot.name }}"
                        data-description="{{ slot.equipment.item.description|default:'Nenhum item equipado' }}"
                        data-rarity="{{ slot.equipment.item.rarity|default:'common' }}"
                        data-rarity-display="{{ slot.equipment.item.get_rarity_display }}"
                        data-min-level="{{ slot.equipment.min_level|default:1 }}"
                        data-stats="{{ slot.equipment.formatted_equipment_stats|default:'' }}"
                        data-attribute-bonuses="{{ slot.equipment.attribute_bonuses_strings|default:'{}'|escapejs }}"
                        data-passive-skill="{{ slot.equipment.passive_skill|default:'{}'|escapejs }}"
                        data-formatted-effects="{{ slot.equipment.formatted_passive_skill_effects }}"
                        data-trigger="{{ slot.equipment.trigger_string }}"
                        data-crafting-recipe="{{ slot.equipment.item.recipe_strings|default:'{}'|escapejs }}"
                    >
                        {% include "items/_equipment_slot.html" with slot_name=slot.name slot_icon=slot.icon slot_equipment=slot.equipment %}
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'game/js/inventory.js' %}"></script>
{% endblock %}