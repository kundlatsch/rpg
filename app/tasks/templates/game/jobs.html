{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="scroll-container jobs-container p-4 p-md-5 mt-4">
    <!-- Cabe√ßalho dos trabalhos -->
    <div class="jobs-header">
        <h1 class="jobs-title">
            ‚öíÔ∏è Trabalhos Dispon√≠veis
        </h1>
        <p class="jobs-subtitle">Escolha uma profiss√£o e comece sua jornada</p>
    </div>

    <!-- Alertas -->
    {% if request.session.alert %}
        <div class="fantasy-alert">
            <div class="alert-emoji">‚ö†Ô∏è</div>
            <div class="alert-message">{{ request.session.alert }}</div>
        </div>
    {% endif %}

    <!-- Grid de Trabalhos -->
    <div class="jobs-grid">
        {% for entry in jobs_with_prof %}
            {% with job=entry.job prof=entry.prof unlocked=entry.is_unlocked %}
                <div class="job-card-compact">
                    <!-- Cabe√ßalho do Card -->
                    <div class="job-card-header">
                        <div class="job-emoji">{{ job.emoji|default:"‚öíÔ∏è" }}</div>
                        <div class="job-title-info">
                            <h4 class="job-title">{{ job.name }}</h4>
                            <div class="job-type">
                                {{ job.profession_type.name }}
                                {% if prof %}
                                    <span class="profession-level">(Nv. {{ prof.level }})</span>
                                {% endif %}
                            </div>
                        </div>
                    </div>

                    <!-- Informa√ß√µes R√°pidas -->
                    <div class="job-quick-info">
                        <div class="requirement">
                            <span class="req-emoji">‚≠ê</span>
                            Nv. {{ job.required_level }}+
                        </div>
                        <div class="duration">
                            <span class="duration-emoji">‚è±Ô∏è</span>
                            {{ job.duration }}min
                        </div>
                    </div>

                    <!-- Descri√ß√£o do Job (sempre vis√≠vel) -->
                    {% if job.description %}
                    <div class="job-description-section">
                        <div class="description-icon">üìù</div>
                        <p class="job-description-text">{{ job.description }}</p>
                    </div>
                    {% endif %}

                    <!-- Recompensas (sempre vis√≠veis) -->
                    <div class="job-rewards-section">
                        <div class="job-rewards-header">
                            <span class="job-rewards-emoji">üéØ</span>
                            <span class="job-rewards-title">Recompensas</span>
                        </div>
                        <div class="job-rewards-grid">
                            <div class="job-reward-item">
                                <span class="job-reward-emoji">üí∞</span>
                                <span class="job-reward-text">{{ job.gold_per_minute|default:0 }} <small>ouro/min</small></span>
                            </div>
                            <div class="job-reward-item">
                                <span class="job-reward-emoji">‚ö°</span>
                                <span class="job-reward-text">{{ job.xp_per_minute|default:0 }} <small>XP/min</small></span>
                            </div>
                            {% if prof %}
                            <div class="job-reward-item">
                                <span class="job-reward-emoji">üìä</span>
                                <span class="job-reward-text">{{ prof.exp|default:0 }} <small>XP profiss√£o</small></span>
                            </div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Drops com _item_slot.html para TODOS os itens -->
                    {% if job.drops.all %}
                    <div class="drops-section">
                        <div class="drops-header">
                            <span class="drops-emoji">üéÅ</span>
                            <span class="drops-title">Recompensas</span>
                        </div>
                        <div class="drops-grid">
                            {% for item in job.drops.all %}
                                <div class="drop-item">
                                    {% include "items/_item_slot.html" with item=item slot_name=item.name drop_chance=item.drop_chance %}
                                    {% if item.drop_chance %}
                                    <div class="drop-chance-badge">
                                        {{ item.drop_chance }}%
                                    </div>
                                    {% endif %}
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}

                    <!-- Status e A√ß√£o -->
                    <div class="job-action-section">
                        {% if unlocked %}
                            <a href="{% url 'start_job' job.id %}" class="btn-start-compact">
                                üöÄ Iniciar Trabalho
                            </a>
                        {% else %}
                            <div class="locked-info">
                                <span class="locked-emoji">üîí</span>
                                <span class="locked-text">
                                    {% if prof %}
                                        N√≠vel insuficiente
                                    {% else %}
                                        Profiss√£o n√£o aprendida
                                    {% endif %}
                                </span>
                            </div>
                        {% endif %}
                    </div>
                </div>
            {% endwith %}
        {% endfor %}
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Anima√ß√£o de entrada para os cards
    const jobCards = document.querySelectorAll('.job-card-compact');
    jobCards.forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'scale(0.9)';
        
        setTimeout(() => {
            card.style.transition = 'all 0.4s ease';
            card.style.opacity = '1';
            card.style.transform = 'scale(1)';
        }, index * 100);
    });

    // Efeito de brilho para cards com profiss√µes desbloqueadas
    const unlockedCards = document.querySelectorAll('.job-card-compact');
    unlockedCards.forEach(card => {
        const btn = card.querySelector('.btn-start-compact');
        if (btn) {
            setInterval(() => {
                card.style.borderColor = card.style.borderColor === 'rgb(220, 20, 60)' ? 
                    'var(--color-border)' : 'var(--color-accent)';
            }, 2000);
        }
    });

    // Efeito de brilho para itens raros nos drops
    const rareItems = document.querySelectorAll('.item-slot.rarity-rare, .item-slot.rarity-epic, .item-slot.rarity-legendary');
    rareItems.forEach(item => {
        setInterval(() => {
            item.style.boxShadow = item.style.boxShadow ? 
                '' : '0 0 10px rgba(255, 215, 0, 0.5)';
        }, 2000);
    });
});
</script>
{% endblock %}