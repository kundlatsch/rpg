{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="scroll-container working-container">
    <!-- Cabe√ßalho compacto -->
    <div class="working-header">
        <div class="working-emoji">{{ char_job.job.emoji }}</div>
        <h1 class="working-title">{{ char_job.job.name }}</h1>
    </div>

    <!-- Informa√ß√µes em linha -->
    <div class="working-info-line">
        <!-- Tempo Restante -->
        <div class="info-item timer-item">
            <div class="info-icon">‚è±Ô∏è</div>
            <div class="info-value" id="timer">{{ time_left }}</div>
            <div class="info-label">minutos restantes</div>
        </div>
        
        <!-- Sal√°rio -->
        <div class="info-item">
            <div class="info-icon">üí∞</div>
            <div class="info-value">{{ char_job.job.gold_per_minute }}</div>
            <div class="info-label">ouro/min</div>
        </div>
        
        <!-- Experi√™ncia (se houver) -->
        {% if char_job.job.xp_per_minute %}
        <div class="info-item">
            <div class="info-icon">‚≠ê</div>
            <div class="info-value">{{ char_job.job.xp_per_minute }}</div>
            <div class="info-label">XP/min</div>
        </div>
        {% endif %}
    </div>

    <!-- Status e a√ß√µes -->
    <div class="working-status">
        {% if job_finished %}
            <div class="status-message">
                ‚úÖ Trabalho conclu√≠do! Colete suas recompensas.
            </div>
            <form action="{% url 'end_job' char_job.job.id %}" method="post">
                {% csrf_token %}
                <button type="submit" class="collect-btn">
                    ‚úÖ Coletar Recompensas
                </button>
            </form>
        {% else %}
            <div class="working-indicator">
                <div class="working-spinner"></div>
                <span>Trabalhando...</span>
            </div>
            <div class="status-message">
                Tempo restante: <span class="status-timer" id="status-timer">{{ time_left }}</span> minutos
            </div>
        {% endif %}
    </div>
</div>

<script>
{% if not job_finished %}
    // Timer minimalista
    let timeLeft = {{ time_left }};
    const timerEl = document.getElementById("timer");
    const statusTimerEl = document.getElementById("status-timer");
    
    // Fun√ß√£o para atualizar o timer
    function updateTimer() {
        if (timerEl) timerEl.textContent = timeLeft;
        if (statusTimerEl) statusTimerEl.textContent = timeLeft;
        
        // Efeito sutil de atualiza√ß√£o
        timerEl.style.opacity = '0.7';
        setTimeout(() => {
            timerEl.style.opacity = '1';
        }, 300);
    }
    
    // Inicializar
    updateTimer();
    
    // Atualizar a cada minuto
    const interval = setInterval(() => {
        if (timeLeft > 0) {
            timeLeft--;
            updateTimer();
        } else {
            clearInterval(interval);
            // Recarregar para mostrar bot√£o de coletar
            setTimeout(() => {
                location.reload();
            }, 1000);
        }
    }, 60000); // 1 minuto
    
{% else %}
    // Efeito sutil para o bot√£o quando trabalho terminado
    document.addEventListener('DOMContentLoaded', function() {
        const btn = document.querySelector('.collect-btn');
        if (btn) {
            setInterval(() => {
                btn.style.transform = btn.style.transform === 'scale(1.02)' ? 
                    'scale(1)' : 'scale(1.02)';
            }, 1500);
        }
    });
{% endif %}
    
    // Efeito de entrada sutil
    document.addEventListener('DOMContentLoaded', function() {
        const container = document.querySelector('.working-container');
        container.style.opacity = '0';
        container.style.transform = 'translateY(10px)';
        container.style.transition = 'opacity 0.4s, transform 0.4s';
        
        setTimeout(() => {
            container.style.opacity = '1';
            container.style.transform = 'translateY(0)';
        }, 100);
    });
</script>
{% endblock %}