{% extends "base.html" %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/pages/dashboard.css' %}">
{% endblock %}

{% block content %}
{% if alert %}
<script>alert("{{ alert }}");</script>
{% endif %}

<div class="dashboard-page">
    <!-- CabeÃ§alho do personagem -->
    <div class="dashboard-header-wrapper">
        <h1 class="dashboard-main-title">{{ character.name }}</h1>
        <p class="dashboard-subtitle">NÃ­vel <strong>{{ character.level }}</strong></p>
    </div>

    <!-- Barras de Recursos -->
    <div class="dashboard-resources">
        <!-- Barra de XP -->
        <div class="resource-d-section">
            <div class="resource-d-progress">
                <div class="progress-bar xp-bar" 
                     style="width: {% widthratio character.exp character.max_exp 100 %}%;">
                </div>
            </div>
            <p class="resource-d-text">{{ character.exp }}/{{ character.max_exp }} EXP</p>
        </div>

        <!-- Barras de HP, Mana e Stamina -->
        <div class="resources-d-grid">
            <div class="resource-d-item">
                <div class="resource-d-header">
                    <span class="resource-d-icon">â¤ï¸</span>
                    <span class="resource-d-name">Vida</span>
                    <span class="resource-d-value">{{ character.hp }}/{{ character.max_hp }}</span>
                </div>
                <div class="resource-d-progress">
                    <div class="progress-bar hp-bar" 
                         style="width: {% widthratio character.hp character.max_hp 100 %}%;">
                    </div>
                </div>
            </div>
            
            <div class="resource-d-item">
                <div class="resource-d-header">
                    <span class="resource-d-icon">ğŸ”®</span>
                    <span class="resource-d-name">Mana</span>
                    <span class="resource-d-value">{{ character.mana }}/{{ character.max_mana }}</span>
                </div>
                <div class="resource-d-progress">
                    <div class="progress-bar mana-bar" 
                         style="width: {% widthratio character.mana character.max_mana 100 %}%;">
                    </div>
                </div>
            </div>
            
            <div class="resource-d-item">
                <div class="resource-d-header">
                    <span class="resource-d-icon">âš¡</span>
                    <span class="resource-d-name">Energia</span>
                    <span class="resource-d-value">{{ character.stamina }}/{{ character.max_stamina }}</span>
                </div>
                <div class="resource-d-progress">
                    <div class="progress-bar stamina-bar" 
                         style="width: {% widthratio character.stamina character.max_stamina 100 %}%;">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="dashboard-divider"></div>

    <!-- Atributos e Emoji -->
    <div class="dashboard-grid">
        <!-- Atributos PrimÃ¡rios -->
        <div class="dashboard-column">
            <div class="dashboard-section">
                <h2 class="dashboard-section-title">Atributos PrimÃ¡rios</h2>
                <div class="attributes-list">
                    <div class="attribute-item">
                        <span class="attribute-icon">ğŸ’ª</span>
                        <span class="attribute-name">ForÃ§a:</span>
                        <span class="attribute-value">{{ character.strength }}</span>
                    </div>
                    <div class="attribute-item">
                        <span class="attribute-icon">ğŸ¹</span>
                        <span class="attribute-name">Destreza:</span>
                        <span class="attribute-value">{{ character.dexterity }}</span>
                    </div>
                    <div class="attribute-item">
                        <span class="attribute-icon">ğŸ”®</span>
                        <span class="attribute-name">Arcano:</span>
                        <span class="attribute-value">{{ character.arcane }}</span>
                    </div>
                    <div class="attribute-item">
                        <span class="attribute-icon">â¤ï¸</span>
                        <span class="attribute-name">ConstituiÃ§Ã£o:</span>
                        <span class="attribute-value">{{ character.constitution }}</span>
                    </div>
                    <div class="attribute-item">
                        <span class="attribute-icon">ğŸ¦</span>
                        <span class="attribute-name">Coragem:</span>
                        <span class="attribute-value">{{ character.courage }}</span>
                    </div>
                    <div class="attribute-item">
                        <span class="attribute-icon">ğŸ€</span>
                        <span class="attribute-name">Sorte:</span>
                        <span class="attribute-value">{{ character.luck }}</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Emoji do Personagem com Slots de Equipamento -->
        <div class="dashboard-column">
            <div class="character-section character-equipment-section">
                <h2 class="character-section-title">ğŸ›¡ï¸ Equipamentos</h2>

                <div class="equipment-layout-compact">

                    <!-- Linha superior (3 slots) -->
                    <div class="equipment-row">
                        <div class="equipment-slot-container">
                            {% include "items/_equipment_slot.html" with slot_name="CabeÃ§a" slot_icon="ğŸ‘‘" slot_equipment=character.equipped_head %}
                        </div>
                        <div class="equipment-slot-container">
                            {% include "items/_equipment_slot.html" with slot_name="Colar" slot_icon="ğŸ“¿" slot_equipment=character.equipped_necklace %}
                        </div>
                        <div class="equipment-slot-container">
                            {% include "items/_equipment_slot.html" with slot_name="Ombro" slot_icon="ğŸ—ï¸" slot_equipment=character.equipped_shoulders %}
                        </div>
                    </div>

                    <!-- Personagem central -->
                    <div class="equipment-row character-center-row">
                        <div class="character-emoji-bg">
                            <div class="character-emoji">
                                {{ character.emoji }}
                            </div>
                        </div>
                    </div>

                    <!-- Linha inferior (3 slots) -->
                    <div class="equipment-row">
                        <div class="equipment-slot-container">
                            {% include "items/_equipment_slot.html" with slot_name="Tronco" slot_icon="ğŸ¦º" slot_equipment=character.equipped_chest %}
                        </div>
                        <div class="equipment-slot-container">
                            {% include "items/_equipment_slot.html" with slot_name="MÃ£os" slot_icon="ğŸ§¤" slot_equipment=character.equipped_hands %}
                        </div>
                        <div class="equipment-slot-container">
                            {% include "items/_equipment_slot.html" with slot_name="PÃ©s" slot_icon="ğŸ‘" slot_equipment=character.equipped_feet %}
                        </div>
                    </div>

                </div>
            </div>


            <div class="dashboard-menu">
                <ul class="dashboard-menu-list">
                    <li><a href="{% url 'character_detail' %}" class="dashboard-menu-btn">ğŸ‘¤ Personagem</a></li>
                    <li><a href="{% url 'inventory' %}" class="dashboard-menu-btn">ğŸ’ InventÃ¡rio</a></li>
                    <li><a href="{% url 'market' %}" class="dashboard-menu-btn">ğŸª Mercado</a></li>
                    <li><a href="#" class="dashboard-menu-btn">ğŸ° Guilda</a></li>
                    <li><a href="{% url 'ranking' %}" class="dashboard-menu-btn">ğŸ† Ranking</a></li>
                </ul>
            </div>
        </div>
        
        <!-- Atributos SecundÃ¡rios -->
        <div class="dashboard-column">
            <div class="dashboard-section">
                <h2 class="dashboard-section-title">Atributos SecundÃ¡rios</h2>
                <div class="attributes-list">
                    <div class="attribute-item">
                        <span class="attribute-icon">âš”ï¸</span>
                        <span class="attribute-name">Dano FÃ­sico:</span>
                        <span class="attribute-value">{{ character.physical_damage }}</span>
                    </div>
                    <div class="attribute-item">
                        <span class="attribute-icon">âœ¨</span>
                        <span class="attribute-name">Dano MÃ¡gico:</span>
                        <span class="attribute-value">{{ character.magical_damage }}</span>
                    </div>
                    <div class="attribute-item">
                        <span class="attribute-icon">ğŸ¯</span>
                        <span class="attribute-name">PrecisÃ£o:</span>
                        <span class="attribute-value">{{ character.accuracy }}</span>
                    </div>
                    <div class="attribute-item">
                        <span class="attribute-icon">ğŸ”¥</span>
                        <span class="attribute-name">Chance de CrÃ­tico:</span>
                        <span class="attribute-value">{{ character.crit_chance }}%</span>
                    </div>
                    <div class="attribute-item">
                        <span class="attribute-icon">ğŸ’¥</span>
                        <span class="attribute-name">Dano CrÃ­tico:</span>
                        <span class="attribute-value">{{ character.crit_damage }}</span>
                    </div>
                    <div class="attribute-item">
                        <span class="attribute-icon">â¤ï¸</span>
                        <span class="attribute-name">Vida Total:</span>
                        <span class="attribute-value">{{ character.total_hp }}</span>
                    </div>
                    <div class="attribute-item">
                        <span class="attribute-icon">ğŸ”®</span>
                        <span class="attribute-name">Mana Total:</span>
                        <span class="attribute-value">{{ character.total_mana }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="dashboard-divider"></div>

    <!-- Status atual -->
    {% if character.training_start %}
        <div class="dashboard-status">
            <h3 class="dashboard-status-title">âš”ï¸ Em Treinamento âš”ï¸</h3>
            <p class="dashboard-status-text">Seu personagem estÃ¡ se tornando mais forte!</p>
            <a href="{% url 'training' %}" class="dashboard-action-btn">Ver Progresso do Treino</a>
        </div>
    {% elif character.resting_start %}
        <div class="dashboard-status">
            <h3 class="dashboard-status-title">ğŸ›Œ Descansando ğŸ›Œ</h3>
            <p class="dashboard-status-text">Seu personagem estÃ¡ recuperando energias!</p>
            <a href="{% url 'resting' %}" class="dashboard-action-btn">Ver Status de Descanso</a>
        </div>
    {% else %}
        <!-- AÃ§Ãµes disponÃ­veis -->
        <h2 class="dashboard-actions-title">AÃ§Ãµes DisponÃ­veis</h2>
        <div class="dashboard-actions-grid">
            <a href="{% url 'training' %}" class="dashboard-action-card training">
                <div class="action-icon">âš”ï¸</div>
                <h4 class="action-title">Treinar</h4>
                <p class="action-description">Aumente suas habilidades</p>
            </a>
            
            <a href="{% url 'resting' %}" class="dashboard-action-card resting">
                <div class="action-icon">ğŸ›Œ</div>
                <h4 class="action-title">Descansar</h4>
                <p class="action-description">Recupere HP e Mana</p>
            </a>
            
            <a href="{% url 'jobs_list' %}" class="dashboard-action-card working">
                <div class="action-icon">âš’ï¸</div>
                <h4 class="action-title">Trabalhar</h4>
                <p class="action-description">Ganhe recursos</p>
            </a>
            
            <a href="{% url 'hunts_list' %}" class="dashboard-action-card quest">
                <div class="action-icon">ğŸ—ºï¸</div>
                <h4 class="action-title">MissÃµes</h4>
                <p class="action-description">Embarca em aventuras</p>
            </a>
            
            <a href="{% url 'combat:arena' %}" class="dashboard-action-card arena">
                <div class="action-icon">ğŸŸï¸</div>
                <h4 class="action-title">Arena</h4>
                <p class="action-description">Desafie outros jogadores</p>
            </a>
            
            <a href="{% url 'craft' %}" class="dashboard-action-card craft">
                <div class="action-icon">ğŸ”§</div>
                <h4 class="action-title">Oficina</h4>
                <p class="action-description">Crie seus itens aqui</p>
            </a>
            
            <a href="{% url 'market' %}" class="dashboard-action-card market">
                <div class="action-icon">ğŸª</div>
                <h4 class="action-title">Entreposto Comercial</h4>
                <p class="action-description">Compra e venda itens de outros jogadores</p>
            </a>
            
            <a href="{% url 'store' %}" class="dashboard-action-card store">
                <div class="action-icon">ğŸ›’</div>
                <h4 class="action-title">EmpÃ³rio</h4>
                <p class="action-description">AbasteÃ§a seus suprimentos</p>
            </a>
        </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // AnimaÃ§Ã£o para os atributos
    const attributeItems = document.querySelectorAll('.attribute-item');
    attributeItems.forEach((item, index) => {
        item.style.opacity = '0';
        item.style.transform = 'translateY(10px)';
        
        setTimeout(() => {
            item.style.transition = 'all 0.4s ease';
            item.style.opacity = '1';
            item.style.transform = 'translateY(0)';
        }, index * 50);
    });

    // AnimaÃ§Ã£o para as barras de recursos
    const progressBars = document.querySelectorAll('.progress-bar');
    progressBars.forEach((bar, index) => {
        const width = bar.style.width;
        bar.style.width = '0';
        
        setTimeout(() => {
            bar.style.transition = 'width 1.5s ease-out';
            bar.style.width = width;
        }, 300 + (index * 100));
    });

    // AnimaÃ§Ã£o para os cards de aÃ§Ã£o
    const actionCards = document.querySelectorAll('.dashboard-action-card');
    actionCards.forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'scale(0.8)';
        
        setTimeout(() => {
            card.style.transition = 'all 0.5s ease';
            card.style.opacity = '1';
            card.style.transform = 'scale(1)';
        }, 500 + (index * 100));
    });

    // Efeito de hover para os cards de aÃ§Ã£o
    actionCards.forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-5px) scale(1.02)';
        });
        
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0) scale(1)';
        });
    });

    // Efeito pulsante para o emoji do personagem
    const characterEmoji = document.querySelector('.character-emoji');
    if (characterEmoji) {
        setInterval(() => {
            characterEmoji.style.filter = characterEmoji.style.filter ? 
                '' : '0 0 20px rgba(231, 201, 143, 0.5)';
        }, 2000);
    }

    // Efeito para itens equipados raros
    const equipmentSlots = document.querySelectorAll('.equipment-slot');
    equipmentSlots.forEach(slot => {
        if (slot.classList.contains('rare') || slot.classList.contains('epic') || slot.classList.contains('legendary')) {
            setInterval(() => {
                slot.style.boxShadow = slot.style.boxShadow ? 
                    '' : '0 0 15px rgba(255, 215, 0, 0.5)';
            }, 1500);
        }
    });
});
</script>
{% endblock %}