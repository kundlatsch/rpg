{% extends "base.html" %}

{% block content %}

{% if alert %}
<script>alert("{{ alert }}");</script>
{% endif %}

<div class="scroll-container p-4 p-md-5 mt-4">
    <!-- CabeÃ§alho do personagem -->
    <div class="text-center mb-4">
        <h1 class="fantasy-title">
            {{ character.name }}
        </h1>
        <p class="mb-0 text-dark">NÃ­vel <strong>{{ character.level }}</strong></p>
    </div>

    <!-- Barra de XP discreta -->
    <div class="row text-dark mb-4">
        <div class="col-12">
                        <!-- Barras de HP, Mana e Stamina -->
            <div class="row text-dark mb-4">
                <div class="col-md-4 mb-3">
                    <div class="resource-bar">
                        <div class="resource-header">
                            <span class="resource-icon">â¤ï¸</span>
                            <span class="resource-name">Vida</span>
                            <span class="resource-value">{{ character.hp }}/{{ character.max_hp }}</span>
                        </div>
                        <div class="progress resource-progress mb-1">
                            <div class="progress-bar bg-hp" role="progressbar" 
                                style="width: {% widthratio character.hp character.max_hp 100 %}%;" 
                                aria-valuenow="{{ character.hp }}" 
                                aria-valuemin="0" 
                                aria-valuemax="{{ character.max_hp }}">
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-4 mb-3">
                    <div class="resource-bar">
                        <div class="resource-header">
                            <span class="resource-icon">ğŸ”®</span>
                            <span class="resource-name">Mana</span>
                            <span class="resource-value">{{ character.mana }}/{{ character.max_mana }}</span>
                        </div>
                        <div class="progress resource-progress mb-1">
                            <div class="progress-bar bg-mana" role="progressbar" 
                                style="width: {% widthratio character.mana character.max_mana 100 %}%;" 
                                aria-valuenow="{{ character.mana }}" 
                                aria-valuemin="0" 
                                aria-valuemax="{{ character.max_mana }}">
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-4 mb-3">
                    <div class="resource-bar">
                        <div class="resource-header">
                            <span class="resource-icon">âš¡</span>
                            <span class="resource-name">Energia</span>
                            <span class="resource-value">{{ character.stamina }}/{{ character.max_stamina }}</span>
                        </div>
                        <div class="progress resource-progress mb-1">
                            <div class="progress-bar bg-stamina" role="progressbar" 
                                style="width: {% widthratio character.stamina character.max_stamina 100 %}%;" 
                                aria-valuenow="{{ character.stamina }}" 
                                aria-valuemin="0" 
                                aria-valuemax="{{ character.max_stamina }}">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="xp-container">
                <div class="progress xp-bar mb-1">
                    <div class="progress-bar bg-xp" role="progressbar" 
                         style="width: {% widthratio character.exp character.max_exp 100 %}%;" 
                         aria-valuenow="{{ character.exp }}" 
                         aria-valuemin="0" 
                         aria-valuemax="{{ character.max_exp }}">
                    </div>
                </div>
                <p class="xp-text text-center mb-0"><small>{{ character.exp }}/{{ character.max_exp }} EXP</small></p>
            </div>
        </div>
    </div>

    <div class="divider"></div>

    <!-- Atributos e Emoji -->
    <div class="row text-dark mb-4">
        <!-- Atributos PrimÃ¡rios -->
        <div class="col-md-4 mb-4">
            <div class="stat-box p-4">
                <h3 class="fantasy-title text-center mb-3">Atributos PrimÃ¡rios</h3>
                <div class="attribute-list">
                    <div class="attribute-item">
                        <span class="attribute-icon">ğŸ’ª</span>
                        <span class="attribute-name">ForÃ§a:</span>
                        <span class="attribute-value">{{ character.strength }}</span>
                    </div>
                    <div class="attribute-item">
                        <span class="attribute-icon">ğŸ¹</span>
                        <span class="attribute-name">Destreza:</span>
                        <span class="attribute-value">{{ character.dexterity }}</span>
                    </div>
                    <div class="attribute-item">
                        <span class="attribute-icon">ğŸ”®</span>
                        <span class="attribute-name">Arcano:</span>
                        <span class="attribute-value">{{ character.arcane }}</span>
                    </div>
                    <div class="attribute-item">
                        <span class="attribute-icon">â¤ï¸</span>
                        <span class="attribute-name">ConstituiÃ§Ã£o:</span>
                        <span class="attribute-value">{{ character.constitution }}</span>
                    </div>
                    <div class="attribute-item">
                        <span class="attribute-icon">ğŸ¦</span>
                        <span class="attribute-name">Coragem:</span>
                        <span class="attribute-value">{{ character.courage }}</span>
                    </div>
                    <div class="attribute-item">
                        <span class="attribute-icon">ğŸ€</span>
                        <span class="attribute-name">Sorte:</span>
                        <span class="attribute-value">{{ character.luck }}</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Emoji do Personagem com Slots de Equipamento -->
        <div class="col-md-4 mb-4">
            <div class="character-equipment-section text-center">
                <!-- Slots superiores -->
                <div class="equipment-row mb-3">
                    {% include "items/_equipment_slot.html" with slot_name="CabeÃ§a" slot_icon="ğŸ‘‘" slot_equipment=character.equipped_head %}
                    {% include "items/_equipment_slot.html" with slot_name="Colar" slot_icon="ğŸ“¿" slot_equipment=character.equipped_necklace %}
                    {% include "items/_equipment_slot.html" with slot_name="Ombro" slot_icon="ğŸ—ï¸" slot_equipment=character.equipped_shoulders %}
                </div>

                <!-- Personagem central -->
                <div class="character-center mb-3">
                    <div class="character-emoji-bg">
                    <div class="character-emoji">
                        {{ character.emoji }}
                    </div>
                    </div>
                </div>

                <!-- Slots inferiores -->
                <div class="equipment-row mt-3">
                    {% include "items/_equipment_slot.html" with slot_name="Tronco" slot_icon="ğŸ¦º" slot_equipment=character.equipped_chest %}
                    {% include "items/_equipment_slot.html" with slot_name="MÃ£os" slot_icon="ğŸ§¤" slot_equipment=character.equipped_hands %}
                    {% include "items/_equipment_slot.html" with slot_name="PÃ©s" slot_icon="ğŸ‘" slot_equipment=character.equipped_feet %}
                </div>
            </div>

            <!-- Menu mock -->
            <div class="character-menu mt-4">
                <ul class="menu-list">
                    <li><a href="{% url 'character_detail' %}" class="menu-btn">ğŸ‘¤ Personagem</a></li>
                    <li><a href="{% url 'inventory' %}" class="menu-btn">ğŸ’ InventÃ¡rio</a></li>
                    <li><a href="{% url 'market' %}" class="menu-btn">ğŸª Mercado</a></li>
                    <li><a href="#" class="menu-btn">ğŸ° Guilda</a></li>
                    <li><a href="#" class="menu-btn">ğŸ† Ranking</a></li>
                </ul>
            </div>
        </div>
        
        <!-- Atributos SecundÃ¡rios -->
        <div class="col-md-4 mb-4">
            <div class="stat-box p-4">
                <h3 class="fantasy-title text-center mb-3">Atributos SecundÃ¡rios</h3>
                <div class="attribute-list">
                    <div class="attribute-item">
                        <span class="attribute-icon">âš”ï¸</span>
                        <span class="attribute-name">Dano FÃ­sico:</span>
                        <span class="attribute-value">{{ character.physical_damage }}</span>
                    </div>
                    <div class="attribute-item">
                        <span class="attribute-icon">âœ¨</span>
                        <span class="attribute-name">Dano MÃ¡gico:</span>
                        <span class="attribute-value">{{ character.magical_damage }}</span>
                    </div>
                    <div class="attribute-item">
                        <span class="attribute-icon">ğŸ¯</span>
                        <span class="attribute-name">PrecisÃ£o:</span>
                        <span class="attribute-value">{{ character.accuracy }}</span>
                    </div>
                    <div class="attribute-item">
                        <span class="attribute-icon">ğŸ”¥</span>
                        <span class="attribute-name">Chance de CrÃ­tico:</span>
                        <span class="attribute-value">{{ character.crit_chance }}%</span>
                    </div>
                    <div class="attribute-item">
                        <span class="attribute-icon">ğŸ’¥</span>
                        <span class="attribute-name">Dano CrÃ­tico:</span>
                        <span class="attribute-value">{{ character.crit_damage }}</span>
                    </div>
                    <div class="attribute-item">
                        <span class="attribute-icon">â¤ï¸</span>
                        <span class="attribute-name">Vida Total:</span>
                        <span class="attribute-value">{{ character.total_hp }}</span>
                    </div>
                    <div class="attribute-item">
                        <span class="attribute-icon">ğŸ”®</span>
                        <span class="attribute-name">Mana Total:</span>
                        <span class="attribute-value">{{ character.total_mana }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="divider my-4"></div>

    <!-- Status atual -->
    {% if character.training_start %}
        <div class="text-center p-4 status-container">
            <h3 class="fantasy-title mb-3">âš”ï¸ Em Treinamento âš”ï¸</h3>
            <p class="text-dark">Seu personagem estÃ¡ se tornando mais forte!</p>
            <a href="{% url 'training' %}" class="fantasy-btn mt-2">Ver Progresso do Treino</a>
        </div>
    {% elif character.resting_start %}
        <div class="text-center p-4 status-container">
            <h3 class="fantasy-title mb-3">ğŸ›Œ Descansando ğŸ›Œ</h3>
            <p class="text-dark">Seu personagem estÃ¡ recuperando energias!</p>
            <a href="{% url 'resting' %}" class="fantasy-btn mt-2">Ver Status de Descanso</a>
        </div>
    {% else %}
        <!-- AÃ§Ãµes disponÃ­veis -->
        <h2 class="fantasy-title text-center mb-4">AÃ§Ãµes DisponÃ­veis</h2>
        <div class="row justify-content-center">
            <div class="col-md-10">
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <a href="{% url 'training' %}" class="action-btn training text-center p-4">
                            <div class="action-icon mb-2">âš”ï¸</div>
                            <h4 class="fantasy-title">Treinar</h4>
                            <p class="mb-0">Aumente suas habilidades</p>
                        </a>
                    </div>
                    <div class="col-md-4 mb-3">
                        <a href="{% url 'resting' %}" class="action-btn resting text-center p-4">
                            <div class="action-icon mb-2">ğŸ›Œ</div>
                            <h4 class="fantasy-title">Descansar</h4>
                            <p class="mb-0">Recupere HP e Mana</p>
                        </a>
                    </div>
                    <div class="col-md-4 mb-3">
                        <a href="{% url 'jobs_list' %}" class="action-btn working text-center p-4">
                            <div class="action-icon mb-2">âš’ï¸</div>
                            <h4 class="fantasy-title">Trabalhar</h4>
                            <p class="mb-0">Ganhe recursos</p>
                        </a>
                    </div>
                    <div class="col-md-6 mb-3">
                        <a href="#" class="action-btn quest text-center p-4">
                            <div class="action-icon mb-2">ğŸ—ºï¸</div>
                            <h4 class="fantasy-title">MissÃµes</h4>
                            <p class="mb-0">Embarca em aventuras</p>
                        </a>
                    </div>
                    <div class="col-md-6 mb-3">
                        <a href="#" class="action-btn arena text-center p-4">
                            <div class="action-icon mb-2">ğŸŸï¸</div>
                            <h4 class="fantasy-title">Arena</h4>
                            <p class="mb-0">Desafie outros jogadores</p>
                        </a>
                    </div>
                    <div class="col-md-6 mb-3">
                        <a href="{% url 'combat:hunt' %}" class="action-btn arena text-center p-4">
                            <div class="action-icon mb-2">ğŸŸï¸</div>
                            <h4 class="fantasy-title">Hunt</h4>
                            <p class="mb-0">Mock caÃ§ada</p>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}
</div>

<style>
    /* Estilos especÃ­ficos para o dashboard */
    .stat-box {
        background: rgba(139, 69, 19, 0.1);
        border-radius: 12px;
        border: 2px solid #8B4513;
        height: 100%;
        transition: transform 0.3s ease;
    }
    
    .stat-box:hover {
        transform: translateY(-5px);
        background: rgba(139, 69, 19, 0.2);
    }
    
    .progress {
        background-color: #D4AF37;
        border: 1px solid #8B4513;
    }
    
    .progress-bar {
        background-color: #8B4513 !important;
    }
    
    .status-container {
        background: rgba(139, 69, 19, 0.15);
        border-radius: 8px;
        border: 2px solid #8B4513;
    }
    
    .action-btn {
        display: block;
        background: rgba(139, 69, 19, 0.1);
        border: 2px solid #8B4513;
        border-radius: 8px;
        text-decoration: none;
        color: #3E2723;
        transition: all 0.3s ease;
        height: 100%;
    }
    
    .action-btn:hover {
        background: rgba(139, 69, 19, 0.2);
        border-color: #D4AF37;
        transform: translateY(-5px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        color: #3E2723;
    }
    
    .action-icon {
        font-size: 2.5rem;
    }
    
    /* Estilos para os atributos */
    .attribute-list {
        display: flex;
        flex-direction: column;
        gap: 0.8rem;
    }
    
    .attribute-item {
        display: flex;
        align-items: center;
        padding: 0.5rem;
        background: rgba(245, 245, 220, 0.2);
        border-radius: 6px;
    }
    
    .attribute-icon {
        font-size: 1.5rem;
        margin-right: 0.75rem;
        width: 30px;
        text-align: center;
    }
    
    .attribute-name {
        flex: 1;
        font-weight: 600;
        color: #3E2723;
    }
    
    .attribute-value {
        font-weight: bold;
        color: #8B4513;
        font-family: 'Cinzel', serif;
    }
    
    /* Barra de XP discreta */
    .xp-container {
        max-width: 400px;
        margin: 0 auto;
    }
    
    .xp-bar {
        height: 8px !important;
        background-color: rgba(212, 175, 55, 0.3) !important;
        border: 1px solid rgba(139, 69, 19, 0.3);
    }
    
    .bg-xp {
        background: linear-gradient(to right, #8B4513, #D4AF37) !important;
    }
    
    .xp-text {
        color: #8B4513;
        font-size: 0.85rem;
    }
    
    /* SeÃ§Ã£o de equipamentos */
    .character-equipment-section {
        padding: 1rem;
        {% comment %} margin: 0 auto;           /* horizontal */
        display: flex;
        flex-direction: column;
        justify-content: center;  /* vertical */
        height: 100%;             /* precisa altura no pai */ {% endcomment %}
    }
    
    .equipment-row {
        display: flex;
        justify-content: space-around;
        align-items: center;
    }
    
    /* Personagem central */
    .character-center {
        display: flex;
        justify-content: center;
        align-items: center;
    }
    
    .character-emoji-bg {
        width: 120px;
        height: 120px;
        background: linear-gradient(135deg, #1ce647ff, #5937d4ff);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 0 15px rgba(139, 69, 19, 0.3);
    }
    
    .character-emoji {
        font-size: 4rem;
        animation: float 3s infinite ease-in-out;
    }
    
    @keyframes float {
        0%, 100% { transform: translateY(0); }
        50% { transform: translateY(-8px); }
    }

    .character-menu {
        max-width: 200px; /* ou outra largura que quiser */
        margin: 0 auto;   /* centraliza */
    }

    .character-menu .menu-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    .character-menu .menu-list li {
        margin-bottom: 0.5rem;
    }

    .character-menu .menu-btn {
        display: block;
        width: 100%;
        padding: 0.5rem 1rem;
        background: rgba(139, 69, 19, 0.1);
        border: 2px solid #8B4513;
        border-radius: 8px;
        text-decoration: none;
        color: #3E2723;
        text-align: center;
        transition: all 0.3s ease;
    }

    .character-menu .menu-btn:hover {
        background: rgba(139, 69, 19, 0.2);
        border-color: #D4AF37;
        transform: translateY(-3px);
    }

    /* Barras de recursos */
    .resource-bar {
        background: rgba(139, 69, 19, 0.1);
        border-radius: 8px;
        border: 1px solid #8B4513;
        padding: 0.75rem;
    }
    
    .resource-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 0.5rem;
    }
    
    .resource-icon {
        font-size: 1.2rem;
    }
    
    .resource-name {
        font-weight: 600;
        color: #3E2723;
        font-family: 'Cinzel', serif;
    }
    
    .resource-value {
        font-size: 0.85rem;
        color: #8B4513;
        font-weight: bold;
    }
    
    .resource-progress {
        height: 10px !important;
        background-color: rgba(212, 175, 55, 0.2) !important;
        border: 1px solid rgba(139, 69, 19, 0.3);
    }
    
    .bg-hp {
        background: linear-gradient(to right, #DC143C, #FF6B6B) !important;
    }
    
    .bg-mana {
        background: linear-gradient(to right, #4B0082, #9370DB) !important;
    }
    
    .bg-stamina {
        background: linear-gradient(to right, #32CD32, #90EE90) !important;
    }

</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Efeito de entrada para a pÃ¡gina
        const container = document.querySelector('.scroll-container');
        container.style.opacity = '0';
        container.style.transition = 'opacity 1s ease-in-out';
        
        setTimeout(() => {
            container.style.opacity = '1';
        }, 100);
    });
</script>

{% endblock %}