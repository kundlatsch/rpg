{% extends "base.html" %}
{% load static %}
{% block content %}

<div class="hunts-page">
    <div class="hunts-header">
        <h1 class="hunts-title">üèπ Ca√ßadas</h1>
        <p class="hunts-subtitle">Enfrente criaturas poderosas e ganhe recompensas √©picas</p>
    </div>

    {% if request.session.alert %}
    <div class="hunt-alert">
        <div class="alert-icon">‚ö†Ô∏è</div>
        <div class="alert-content">
            <div class="alert-title">Aviso</div>
            <div class="alert-message">{{ request.session.alert }}</div>
        </div>
    </div>
    {% endif %}

    <div class="hunts-container">
        <div class="hunts-grid">
            {% for hunt in hunts %}
            <div class="hunt-card {% if character.level >= hunt.required_level %}hunt-available{% else %}hunt-locked{% endif %}">
                <div class="hunt-card-header">
                    <div class="hunt-icon">
                        {% if character.level >= hunt.required_level %}üèπ{% else %}üîí{% endif %}
                    </div>
                    <div class="hunt-title">
                        <h3>{{ hunt.name }}</h3>
                        {% if hunt.difficulty == 1 %}<span class="hunt-difficulty-badge hunt-difficulty-{{ hunt.difficulty }}">F√°cil</span>{% endif %}
                        {% if hunt.difficulty == 2 %}<span class="hunt-difficulty-badge hunt-difficulty-{{ hunt.difficulty }}">M√©dia</span>{% endif %}
                        {% if hunt.difficulty == 3 %}<span class="hunt-difficulty-badge hunt-difficulty-{{ hunt.difficulty }}">Dif√≠cil</span>{% endif %}
                        {% if hunt.difficulty == 4 %}<span class="hunt-difficulty-badge hunt-difficulty-{{ hunt.difficulty }}">√âpica</span>{% endif %}
                        {% if hunt.difficulty == 5 %}<span class="hunt-difficulty-badge hunt-difficulty-{{ hunt.difficulty }}">Lend√°ria</span>{% endif %}
                        <div class="hunt-level-requirement">
                            <span class="requirement-label">Nv. necess√°rio:</span>
                            <span class="requirement-value {% if character.level >= hunt.required_level %}requirement-met{% else %}requirement-failed{% endif %}">
                                {{ hunt.required_level }}
                            </span>
                        </div>
                        
                    </div>
                </div>

                <div class="hunt-card-body">
                    <div class="hunt-info-grid">
                        <div class="hunt-info-item">
                            <div class="hunt-info-value">‚è±Ô∏è Dura√ß√£o: {{ hunt.duration }}min</div>
                        </div>
                    </div>

                    <div class="hunt-monsters-section">
                        <h4 class="hunt-section-title">Monstros</h4>
                        <div class="hunt-monsters-grid">
                            {% for hm in hunt.monsters.all %}
                            <div class="hunt-monster-emoji" 
                                data-monster-name="{{ hm.monster.name }}"
                                data-monster-level="{{ hm.monster.level }}"
                                data-monster-emoji="{{ hm.monster.emoji }}"
                                data-monster-xp-drop="{{ hm.xp_drop }}"
                                data-monster-gold-drop="{{ hm.gold_drop }}"
                                data-monster-items-drop="{{ hm.item_drops_display }}">
                                {{ hm.monster.emoji }}
                                <div class="hunt-monster-tooltip">
                                    <div class="hunt-tooltip-name">{{ hm.monster.name }}</div>
                                    <div class="hunt-tooltip-level">N√≠vel {{ hm.monster.level }}</div>
                                </div>
                            </div>
                            {% empty %}
                            <div class="hunt-no-monsters">Nenhum monstro</div>
                            {% endfor %}
                        </div>
                    </div>

                    <div class="hunt-description">
                        <p>{{ hunt.description|default:"Enfrente criaturas perigosas nesta ca√ßada." }}</p>
                    </div>
                </div>

                <div class="hunt-card-footer">
                    {% if character.level >= hunt.required_level %}
                    <a href="{% url 'start_hunt' hunt.id %}" class="hunt-btn hunt-btn-primary">
                        <span class="hunt-btn-icon">üèπ</span>
                        Ca√ßar
                    </a>
                    {% else %}
                    <div class="hunt-blocked">
                        <div class="hunt-blocked-icon">üîí</div>
                        <div class="hunt-blocked-message">
                            <div class="hunt-blocked-title">Bloqueado</div>
                            <div class="hunt-blocked-desc">N√≠vel {{ hunt.required_level }} necess√°rio</div>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% empty %}
            <div class="no-hunts">
                <div class="no-hunts-icon">üèïÔ∏è</div>
                <div class="no-hunts-message">
                    <h3>Nenhuma Ca√ßada Dispon√≠vel</h3>
                    <p>Complete miss√µes para desbloquear novas ca√ßadas ou volte mais tarde.</p>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>


<script>
document.addEventListener('DOMContentLoaded', function() {
    // Inicializar tooltips para monstros
    const monsterEmojis = document.querySelectorAll('.hunt-monster-emoji');
    
    monsterEmojis.forEach(emoji => {
        const monsterName = emoji.getAttribute('data-monster-name');
        const monsterLevel = emoji.getAttribute('data-monster-level');
        const monsterXpDrop = emoji.getAttribute('data-monster-xp-drop');
        const monsterGoldDrop = emoji.getAttribute('data-monster-gold-drop');
        const monsterItemsDrop = emoji.getAttribute('data-monster-items-drop');
        
        // Criar um tooltip global √∫nico
        let globalTooltip = document.getElementById('hunt-global-tooltip');
        if (!globalTooltip) {
            globalTooltip = document.createElement('div');
            globalTooltip.id = 'hunt-global-tooltip';
            globalTooltip.className = 'hunt-monster-tooltip';
            document.body.appendChild(globalTooltip);
            
            // Estilos para o tooltip global
            globalTooltip.style.cssText = `
                position: fixed;
                background: rgba(30, 30, 30, 0.95);
                border: 1px solid rgba(255, 107, 107, 0.5);
                border-radius: 8px;
                padding: 10px;
                color: #FFFFFF;
                font-size: 0.9rem;
                z-index: 9999;
                opacity: 0;
                visibility: hidden;
                transition: opacity 0.3s, visibility 0.3s;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.6);
                pointer-events: none;
                min-width: 150px;
                transform: translate(-50%, -100%);
                top: 0;
                left: 0;
            `;
        }
        
        // Adicionar evento para tooltip
        emoji.addEventListener('mouseenter', function(e) {
            const rect = this.getBoundingClientRect();
            const x = rect.left + (rect.width / 2);
            const y = rect.top;
            
            // Atualizar conte√∫do do tooltip
            globalTooltip.innerHTML = `
                <div class="hunt-tooltip-name">${monsterName}</div>
                <div class="hunt-tooltip-level">N√≠vel ${monsterLevel}</div>
                <div class="hunt-tooltip-drop">Gold: ${monsterGoldDrop}</div>
                <div class="hunt-tooltip-drop">XP: ${monsterXpDrop}</div>
                <div class="hunt-tooltip-drop">Drops: ${monsterItemsDrop}</div>
            `;
            
            // Posicionar tooltip
            globalTooltip.style.left = x + 'px';
            globalTooltip.style.top = (y - 10) + 'px';
            globalTooltip.style.opacity = '1';
            globalTooltip.style.visibility = 'visible';
        });
        
        emoji.addEventListener('mouseleave', function(e) {
            globalTooltip.style.opacity = '0';
            globalTooltip.style.visibility = 'hidden';
        });
        
        emoji.addEventListener('mousemove', function(e) {
            // Atualizar posi√ß√£o do tooltip com o mouse
            const x = e.clientX;
            const y = e.clientY;
            globalTooltip.style.left = x + 'px';
            globalTooltip.style.top = (y - 40) + 'px';
        });
        
        // Efeito de brilho para monstros raros
        const level = parseInt(monsterLevel);
        if (level >= 15) {
            setInterval(() => {
                emoji.style.filter = emoji.style.filter === 'drop-shadow(0 0 5px gold)' ? 
                    'none' : 'drop-shadow(0 0 5px gold)';
            }, 2000);
        } else if (level >= 10) {
            setInterval(() => {
                emoji.style.filter = emoji.style.filter === 'drop-shadow(0 0 5px #A855F7)' ? 
                    'none' : 'drop-shadow(0 0 5px #A855F7)';
            }, 2500);
        }
    });
    
    // Efeito de entrada para os cards
    const huntCards = document.querySelectorAll('.hunt-card');
    huntCards.forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(20px)';
        
        setTimeout(() => {
            card.style.transition = 'opacity 0.5s, transform 0.5s';
            card.style.opacity = '1';
            card.style.transform = 'translateY(0)';
        }, index * 100);
    });
    
    // Efeito de brilho para ca√ßadas desbloqueadas
    const availableCards = document.querySelectorAll('.hunt-card.hunt-available');
    availableCards.forEach(card => {
        setInterval(() => {
            card.style.borderColor = card.style.borderColor === 'rgba(78, 205, 196, 0.8)' ? 
                'rgba(78, 205, 196, 0.5)' : 'rgba(78, 205, 196, 0.8)';
        }, 3000);
    });
    
    // Remover tooltip global ao sair da p√°gina
    document.addEventListener('mouseleave', function(e) {
        const globalTooltip = document.getElementById('hunt-global-tooltip');
        if (globalTooltip) {
            globalTooltip.style.opacity = '0';
            globalTooltip.style.visibility = 'hidden';
        }
    });
});
</script>

{% endblock %}