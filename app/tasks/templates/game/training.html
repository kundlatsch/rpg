{% extends "base.html" %}
{% load static %}
{% block content %}

{% if alert %}
<div class="alert-overlay" id="alert-overlay">
    <div class="alert-modal">
        <div class="alert-icon">âš ï¸</div>
        <div class="alert-message">{{ alert }}</div>
        <button class="alert-close-btn" onclick="document.getElementById('alert-overlay').style.display='none'">OK</button>
    </div>
</div>
{% endif %}

<div class="training-page">
    
    {% if character.training_start %}
    <!-- Tela quando jÃ¡ estÃ¡ treinando -->
    <div class="training-active">
        <div class="training-header">
            <h1 class="training-title">ğŸ’ª VocÃª estÃ¡ Treinando</h1>
            <p class="training-subtitle">Forjando seu corpo e mente para batalhas futuras</p>
        </div>
        
        <!-- Cena de treino animada -->
        <div class="training-scene-container">
            <div class="training-scene">
                <!-- Personagem treinando -->
                <div class="training-character">
                    <div class="training-activity" id="activity-1">ğŸ’ª</div>
                    <div class="training-activity" id="activity-2">ğŸƒ</div>
                    <div class="training-activity" id="activity-3">âš”ï¸</div>
                    <div class="training-activity" id="activity-4">ğŸ›¡ï¸</div>
                </div>
                
                <!-- Efeitos visuais -->
                <div class="training-effects">
                    <div class="effect sweat"></div>
                    <div class="effect sweat"></div>
                    <div class="effect sweat"></div>
                    <div class="effect energy"></div>
                    <div class="effect energy"></div>
                </div>
            </div>
        </div>
        
        <!-- EstatÃ­sticas do treino -->
        <div class="training-stats-grid">
            <div class="training-stat">
                <div class="stat-icon">â³</div>
                <div class="stat-content">
                    <h3 class="stat-title">Tempo Decorrido</h3>
                    <div class="stat-value" id="training-timer">0m 0s</div>
                </div>
            </div>
            
            <div class="training-stat">
                <div class="stat-icon">ğŸ’ª</div>
                <div class="stat-content">
                    <h3 class="stat-title">Energia</h3>
                    <div class="stat-value">{{ config.training_stamina_per_minute }}/min</div>
                </div>
            </div>
            
            <div class="training-stat">
                <div class="stat-icon">â­</div>
                <div class="stat-content">
                    <h3 class="stat-title">ExperiÃªncia</h3>
                    <div class="stat-value">{{ config.training_xp_per_minute }}/min</div>
                </div>
            </div>
        </div>
        
        <!-- BotÃµes de aÃ§Ã£o -->
        <div class="training-actions">
            <a href="{% url 'end_training' %}" class="training-btn training-btn-danger">
                <span class="btn-icon">â›”</span>
                Encerrar Treino
            </a>
            <a href="{% url 'dashboard' %}" class="training-btn training-btn-secondary">
                <span class="btn-icon">ğŸ°</span>
                Voltar ao Dashboard
            </a>
        </div>
    </div>
    
    {% else %}
    <!-- Tela antes de iniciar -->
    <div class="training-setup">
        <div class="training-header">
            <h1 class="training-title">ğŸ‹ï¸ Treinamento</h1>
            <p class="training-subtitle">FortaleÃ§a suas habilidades para os desafios que virÃ£o</p>
        </div>
        
        <!-- BenefÃ­cios do treino -->
        <div class="training-benefits">
            <div class="benefit-card">
                <div class="benefit-icon">âš”ï¸</div>
                <div class="benefit-content">
                    <h3 class="benefit-title">Ficando mais forte</h3>
                    <p class="benefit-description">Treinar Ã© uma maneira simples de ganhar experiÃªncia</p>
                </div>
            </div>
            
            <div class="benefit-card">
                <div class="benefit-icon">ğŸ›¡ï¸</div>
                <div class="benefit-content">
                    <h3 class="benefit-title">No pain, no gain</h3>
                    <p class="benefit-description">Quanto mais tempo vocÃª passar treinando, mais XP receberÃ¡</p>
                </div>
            </div>
            
            <div class="benefit-card">
                <div class="benefit-icon">âš¡</div>
                <div class="benefit-content">
                    <h3 class="benefit-title">CansaÃ§o</h3>
                    <p class="benefit-description">VocÃª perderÃ¡ energia de acordo com o tempo de treino</p>
                </div>
            </div>
            
        </div>
        
        <!-- EstatÃ­sticas de treino -->
        <div class="training-info-grid">
            <div class="info-card">
                <div class="info-icon">â­</div>
                <div class="info-content">
                    <div class="info-title">ExperiÃªncia por minuto</div>
                    <div class="info-value">{{ config.training_xp_per_minute }} XP</div>
                </div>
            </div>
            
            <div class="info-card">
                <div class="info-icon">ğŸ’ª</div>
                <div class="info-content">
                    <div class="info-title">Energia consumida por minuto</div>
                    <div class="info-value">{{ config.training_stamina_per_minute }}</div>
                </div>
            </div>
            
            <div class="info-card">
                <div class="info-icon">â±ï¸</div>
                <div class="info-content">
                    <div class="info-title">DuraÃ§Ã£o mÃ¡xima</div>
                    <div class="info-value">60 minutos</div>
                </div>
            </div>
            
        </div>
        
        <!-- BotÃµes de aÃ§Ã£o -->
        <div class="training-actions">
            <a href="{% url 'start_training' %}" class="training-btn training-btn-primary">
                <span class="btn-icon">âš¡</span>
                Iniciar Treino
            </a>
            <a href="{% url 'dashboard' %}" class="training-btn training-btn-secondary">
                <span class="btn-icon">ğŸ°</span>
                Voltar ao Dashboard
            </a>
        </div>
    </div>
    {% endif %}
</div>

<script>
    {% if character.training_start %}
    // Timer para treino ativo
    let trainingStartTime = new Date("{{ character.training_start|date:'Y-m-d H:i:s' }}");
    
    function updateTrainingTimer() {
        let now = new Date();
        let diff = Math.floor((now - trainingStartTime) / 1000);
        let hours = Math.floor(diff / 3600);
        let minutes = Math.floor((diff % 3600) / 60);
        let seconds = diff % 60;
        
        let timerText = '';
        if (hours > 0) {
            timerText = `${hours}h ${minutes}m ${seconds}s`;
        } else {
            timerText = `${minutes}m ${seconds}s`;
        }
        
        document.getElementById('training-timer').textContent = timerText;
    }
    
    setInterval(updateTrainingTimer, 1000);
    updateTrainingTimer(); // Chamada inicial
    {% endif %}
</script>

{% endblock %}